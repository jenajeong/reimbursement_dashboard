<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wise Music Dashboard - Auth</title>
    
    <!-- HTMX 라이브러리 로드 -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    
    <style>
        /* Wise Music Dashboard 스타일 반영 */
        :root {
            --primary-blue: #007bff; /* 대시보드의 메인 파란색 */
            --dark-header: #2c3e50; /* 헤더의 진한 남색 */
            --light-bg: #f8f9fa; /* 밝은 배경색 */
            --card-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        body { font-family: 'Arial', sans-serif; background-color: var(--light-bg); margin: 0; padding: 0; display: flex; flex-direction: column; min-height: 100vh; }
        
        /* 헤더 스타일 */
        header { background: var(--dark-header); color: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h1 { margin: 0; font-size: 1.5rem; }

        /* 인증 컨테이너: 로그인/회원가입 폼을 중앙에 띄웁니다. */
        #auth-container { 
            position: fixed; 
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* 반투명 배경 */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        /* 인증 카드 스타일 */
        .auth-card {
            background: white; 
            padding: 30px; 
            border-radius: 8px; 
            box-shadow: var(--card-shadow); 
            width: 320px; 
            text-align: center;
        }
        
        .header-logo { color: var(--primary-blue); margin-bottom: 20px; font-weight: bold; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; }
        .form-group { margin-bottom: 15px; }
        input[type="text"], input[type="password"], input[type="date"] { 
            width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; 
        }
        
        /* 버튼 스타일 */
        .auth-button { 
            background-color: var(--primary-blue); 
            color: white; 
            padding: 12px 15px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            width: 100%; 
            margin-top: 10px; 
            font-weight: bold; 
            transition: background-color 0.3s; 
        }
        .auth-button:hover { background-color: #0056b3; }
        
        .auth-link { margin-top: 15px; font-size: 0.9em; }
        .auth-link a { color: var(--primary-blue); text-decoration: none; cursor: pointer; }
        
        main { flex-grow: 1; padding: 20px; }
    </style>
</head>
<body>
    <header>
        <h1>Wise Music Dashboard</h1>
        
        <!-- 인증 UI 컨테이너 (hx-trigger="load"로 로그인 폼 초기 로드) -->
        <!-- 처음에는 로그인 폼을 로드하여 전체 화면 모달로 띄웁니다. -->
        <div id="auth-container" 
             hx-get="{% url 'login_form_only' %}" 
             hx-trigger="load" 
             hx-swap="outerHTML">
        </div>
    </header>
    
    <main>
        {% block content %}
            <!-- 하위 템플릿 내용이 여기에 삽입됩니다. -->
        {% endblock content %}
    </main>
    
    <!-- JWT 요청 구성 스크립트 (<body> 닫기 전) -->
    <script>
        // 모든 HTMX 요청 전에 Access Token을 Authorization 헤더에 삽입
        document.body.addEventListener('htmx:configRequest', (event) => {
            const token = localStorage.getItem('access_token');
            if (token) {
                event.detail.headers['Authorization'] = `Bearer ${token}`;
            }
        });
        
        // 로그아웃 처리 함수
        function handleLogout() {
            localStorage.removeItem('access_token');
            localStorage.removeItem('refresh_token');
            
            // auth-container를 다시 로드하여 로그인 폼 모달을 띄움
            htmx.ajax('GET', '{% url "login_form_only" %}', {target: 'body', swap: 'afterbegin'});
            
            // 홈 페이지로 이동 
            window.location.href = "{% url 'home' %}";
        }
    </script>
</body>
</html>