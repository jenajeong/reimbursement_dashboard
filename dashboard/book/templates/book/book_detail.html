{% extends "book/base.html" %}
{% load static %}

{% block title %}{{ book.title_korean }} - ìƒì„¸ ì •ë³´{% endblock %}

{% block head %}
<!-- [ì‹ ê·œ] ìƒì„¸ í˜ì´ì§€ìš© CSS íŒŒì¼ ë¡œë“œ -->
<link rel="stylesheet" href="{% static 'css/book/book_detail.css' %}">
{% endblock %}


{% block content %}
<div class="content-header-form">
    <!-- ì±… ì œëª© -->
    <h1 class="page-title" style="margin-bottom: 0;">{{ book.title_korean }}</h1>
    
    <!-- ğŸ‘‡ [ìˆ˜ì •] 1. ë²„íŠ¼ ê·¸ë£¹ -->
    <div class="header-buttons">
        <a href="{% url 'book_list' %}" class="back-button">â† ëª©ë¡ìœ¼ë¡œ</a>
        <a href="{% url 'book_edit_page' book.pk %}" class="submit-btn">ìˆ˜ì •í•˜ê¸°</a>
    </div>
</div>

<!-- ìƒì„¸ ì •ë³´ ì»¨í…Œì´ë„ˆ -->
<div class="detail-container">

    <!-- 1. ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ -->
    <div class="detail-section">
        <h2 class="form-section-title">ê¸°ë³¸ ì •ë³´</h2>
        
        <!-- ğŸ‘‡ [ìˆ˜ì •] 2 & 3. ì €ì, ì¹´í…Œê³ ë¦¬ í•­ëª©ì„ 2ì—´ ê·¸ë¦¬ë“œì— í¬í•¨ -->
        <div class="info-grid">
            <div class="info-row">
                <span class="info-label">ì±… ì œëª© (í•œê¸€)</span>
                <span class="info-value">{{ book.title_korean }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">ì±… ì œëª© (ì›ì–´)</span>
                <span class="info-value">{{ book.title_original|default:"-" }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">ì¶œíŒì‚¬</span>
                <span class="info-value">{{ book.publisher|default:"-" }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">ì±… ì¢…ë¥˜</span>
                <span class="info-value">{{ book.get_book_type_display }}</span>
            </div>
            
            <!-- ğŸ‘‡ [ìˆ˜ì •] 3. ì¹´í…Œê³ ë¦¬ 1, 2ë¥¼ í•˜ë‚˜ë¡œ ë³‘í•© -->
            <div class="info-row">
                <span class="info-label">ì¹´í…Œê³ ë¦¬</span>
                <span class="info-value">
                    {% if book.category1 %}
                        {{ book.category1 }}
                        {% if book.category2 %} &gt; {{ book.category2 }}{% endif %}
                    {% else %}
                        -
                    {% endif %}
                </span>
            </div>
            
            <!-- ğŸ‘‡ [ìˆ˜ì •] 2. ì €ì ì •ë³´ë¥¼ í…Œì´ë¸”ì´ ì•„ë‹Œ ê·¸ë¦¬ë“œ í•­ëª©ìœ¼ë¡œ -->
            <div class="info-row">
                <span class="info-label">ì €ì</span>
                <span class="info-value">
                    {% for author in book.authors.all %}
                        {{ author.name }}{% if not forloop.last %}, {% endif %}
                    {% empty %}
                        -
                    {% endfor %}
                </span>
            </div>
        </div>
        <!-- ğŸ‘† [ìˆ˜ì •] ê¸°ë³¸ ì •ë³´ ê·¸ë¦¬ë“œ ë -->

    </div>
    
    <!-- 2. ì‘ê³¡ê°€ ì •ë³´ (í…Œì´ë¸” ìœ ì§€) -->
    <div class="detail-section">
        <h2 class="form-section-title">ì‘ê³¡ê°€ ì •ë³´</h2>
        <table class="detail-table">
            <thead>
                <tr>
                    <th>ì‘ê³¡ê°€ëª…</th>
                    <th>ìƒë…„ì›”ì¼</th>
                    <th>ê³¡ ìˆ˜</th>
                    <th>ì €ì‘ê¶Œë£Œ (%)</th>
                </tr>
            </thead>
            <tbody>
                {% for work in book.composerwork_set.all %}
                <tr>
                    <td>{{ work.composer.name }}</td>
                    <!-- ğŸ‘‡ [ìˆ˜ì •] 4. ë‚ ì§œ í˜•ì‹ ë³€ê²½ -->
                    <td>{{ work.composer.date_of_birth|date:"Yë…„ mì›” dì¼"|default:"-" }}</td>
                    <td>{{ work.number_of_songs }}</td>
                    <td>{{ work.royalty_percentage }}%</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="no-data">ë“±ë¡ëœ ì‘ê³¡ê°€ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- 3. ê°€ê²© ë³€ë™ ì´ë ¥ (ë³€ê²½ ì—†ìŒ) -->
    <div class="detail-section">
        <h2 class="form-section-title">ê°€ê²© ë³€ë™ ì´ë ¥</h2>
        <table class="detail-table">
            <thead>
                <tr>
                    <th>ì ìš©ì¼</th>
                    <th>ê°€ê²©</th>
                    <th>ìƒíƒœ</th>
                </tr>
            </thead>
            <tbody>
                {% for history in book.price_histories.all %}
                <tr>
                    <td>{{ history.price_updated_at|date:"Y-m-d H:i" }}</td>
                    <td>{{ history.price|floatformat:"-3g" }}ì›</td>
                    <td>
                        {% if history.is_latest %}
                            <span class="status-badge active">í˜„ì¬ ê°€ê²©</span>
                        {% else %}
                            <span class="status-badge inactive">ì´ì „ ê°€ê²©</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" class="no-data">ê°€ê²© ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</div>
{% endblock %}

