{% load static %}
{% load humanize %} <!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>주문 상세 (ID: {{ order.id }})</title>
    <link rel="stylesheet" href="{% static 'css/order/add_order.css' %}">
    
    <link rel="stylesheet" href="{% static 'css/order/order_detail.css' %}">
</head>
<body>
    <div class="container">
        <!-- ... (sidebar HTML) ... -->
        <nav class="sidebar">
            <div style="font-size: 1.5em; font-weight: 700; margin-bottom: 40px; color: #007bff;">Wise Music Dashboard</div>
            <div class="sidebar-nav">
                <a href="{% url 'order_list' %}" class="nav-item active">주문 목록</a>
                <a href="{% url 'add_order' %}" class="nav-item">주문 추가</a>
                <a href="{% url 'book_list' %}" class="nav-item">책 관리</a>
                <a href="{% url 'reimbursement_base' %}" class="nav-item">정산 관리</a>
            </div>
        </nav>

        <main class="content">
            <h1 class="page-title">주문 상세 (ID: {{ order.id }})</h1>

            <div class="add-order-form"> 

                <div class="modal-header-layout">
                    <h2 class="modal-title">주문 정보</h2>
                    <!-- [수정] href="#" -> "{% url 'order_edit' order.pk %}" -->
                    <a href="{% url 'order_edit' order.pk %}" class="save-button">주문 수정</a>
                </div>

                <!-- ... (주문 정보 .form-section) ... -->
                <div class="form-section">
                    <div class="form-section-title">배송 정보</div>
                    <div class="form-section-fields">
                        <div class="form-row-group">
                            <label class="form-label">주문자명</label>
                            <div class="data-value">{{ order.customer.name }}</div>
                        </div>
                        <div class="form-row-group">
                            <label class="form-label">연락처</label>
                            <div class="data-value">{{ order.customer.contact_number }}</div>
                        </div>
                        <div class="form-row-group">
                            <label class="form-label">주소</label>
                            <div class="data-value">{{ order.customer.address }}</div>
                        </div>
                        <div class="form-row-group">
                            <label class="form-label">주문일</label>
                            <div class="data-value">{{ order.order_date|date:"Y.m.d H:i" }}</div>
                        </div>
                         <div class="form-row-group">
                            <label class="form-label">배송일</label>
                            <div class="data-value">{{ order.delivery_date|date:"Y.m.d"|default:"(미지정)" }}</div>
                        </div>
                        <div class="form-row-group">
                            <label class="form-label">주문처 & 배송</label>
                            <div class="data-value">{{ order.order_source }} / {{ order.delivery_method }}</div>
                        </div>
                        <div class="form-row-group">
                            <label class="form-label">결제방법</label>
                            <div class="data-value">{{ order.get_payment_method_display }}</div> 
                        </div>
                         <div class="form-row-group">
                            <label class="form-label">결제일</label>
                            <div class="data-value">{{ order.payment_date|date:"Y.m.d"|default:"(미결제)" }}</div>
                        </div>
                        <div class="form-row-group">
                            <label class="form-label">요청사항</label>
                            <div class="data-value data-multiline">{{ order.requests|default:"(없음)" }}</div>
                        </div>
                    </div>
                </div>

                <hr class="section-divider">

                <div class="form-section">
                    <div class="form-section-title">상품 정보</div>
                    <div class="form-section-fields">
                        <div class="order-items-table-container">
                            <table class="order-items-table">
                                <thead>
                                    <tr>
                                        <th>상품명</th>
                                        <th>(책)수량</th>
                                        <th>할인율</th>
                                        <th>제본수량</th>
                                        <th>공급가 (항목별)</th>
                                    </tr>
                                </thead>
                                <tbody id="order-items-tbody">
                                    {% for item in order_items %}
                                    <tr>
                                        <!-- [수정] 
                                          1. <a> 태그로 상품명 감싸기
                                          2. href="{% url 'book_detail' item.book.pk %}"
                                          3. target="_blank" rel="noopener noreferrer"
                                        -->
                                        <td>
                                            <a href="{% url 'book_detail' item.book.pk %}" target="_blank" rel="noopener noreferrer">
                                                {{ item.book.title_korean }}
                                            </a>
                                        </td>
                                        <td>{{ item.quantity }}</td>
                                        <td>{{ item.discount_rate|floatformat:0 }}%</td>
                                        <td>{{ item.additional_quantity }}</td>
                                        <td>{{ item.total_price|intcomma }}원</td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="5">주문한 상품이 없습니다.</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="form-row-group total-price-row">
                            <label class="form-label total-label">총 주문 금액</label>
                            <div class="total-display">{{ grand_total|intcomma }}원</div>
                        </div>
                    </div>
                </div>
                
                <div class="button-group-bottom">
                    <a href="{% url 'order_list' %}" class="cancel-button">목록으로</a>
                </div>

            </div> 
        </main> 
    </div> 
</body>
</html>