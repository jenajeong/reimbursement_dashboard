{% load humanize %} 

{% for order in orders %}
<tr hx-target="this" hx-swap="outerHTML">
    <td>{{ forloop.counter }}</td> 
    <td>{{ order.customer.name }}</td>
    <td class="td-address">{{ order.customer.address }}</td>
    <td>{{ order.customer.contact_number }}</td>

    <td>
        {% with first_item=order.order_items.all.0 %}
            {% if first_item %}
                <a href="{% url 'order_detail' order.id %}" class="table-link">
                    {{ first_item.book.title_korean }}
                </a>
                
                {% if order.total_types > 1 %}
                    <span style="color: #666; font-size: 0.9em;">
                        외 {{ order.total_types|add:"-1" }}종
                    </span>
                {% endif %}
            {% else %}
                (상품 없음)
            {% endif %}
        {% endwith %}

        <span style="font-weight: bold;">
            (총 {{ order.total_quantity|default:0 }}권)
        </span>
    </td>
    
    <td>{{ order.order_date|date:"Y.m.d H:i" }}</td>
    <td>{{ order.delivery_date|date:"Y.m.d"|default:"-" }}</td>
    
    <td>
        <a href="{% url 'order_edit' order.id %}" class="btn-edit">수정</a>
    </td>
</tr>
{% empty %}
<tr>
    <td colspan="8" class="no-data">
        {% if search_query or start_date or order_source != 'all' %}
            검색 조건에 맞는 주문 내역이 없습니다.
        {% else %}
            주문 내역이 없습니다.
        {% endif %}
    </td>
</tr>
{% endfor %}