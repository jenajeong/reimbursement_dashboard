<div id="auth-container" class="auth-modal">
    <div class="auth-card">
        <div class="header-logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-key-round"><path d="M2 18L12.016 7.984C14.184 5.816 17.656 5.816 19.824 7.984L21.034 9.194C23.202 11.362 23.202 14.834 21.034 17.002L11.018 27.018"/></svg>
            <span class="brand-name">Wise Music 대시보드 회원가입</span>
        </div>
        <h2>로그인</h2>
        <form hx-post="{% url 'api_token_obtain_pair' %}" 
              hx-on="htmx:afterRequest: if(event.detail.successful) { handleLoginSuccess(event.detail.xhr.response); } 
                                     else { handleLoginFailure(event.detail.xhr.responseText); }">
            
            {% csrf_token %}
            <div class="form-group"><input type="text" name="username" placeholder="아이디" required></div>
            <div class="form-group"><input type="password" name="password" placeholder="비밀번호" required></div>
            <button type="submit" class="auth-button">로그인</button>
        </form>
        
        <div id="auth-messages" style="margin-top: 10px; color: red;"></div>
        
        <p class="auth-link">계정이 없으신가요? <a hx-get="{% url 'signup_form_only' %}" hx-target="#auth-container">회원가입</a></p>
    </div>
</div>

<script>
    function handleLoginSuccess(response) {
        try {
            const data = JSON.parse(response);
            localStorage.setItem('accessToken', data.access);
            localStorage.setItem('refreshToken', data.refresh);
            
            // 모달을 제거하고 페이지 이동 (주문 목록으로 리다이렉션)
            const redirectUrl = "{% url 'order_list' %}"; 
            window.location.href = redirectUrl; 
            
        } catch (e) {
            document.getElementById('auth-messages').innerHTML = '<p>응답 처리 중 오류가 발생했습니다.</p>';
        }
    }

    function handleLoginFailure(responseText) {
        let message = "아이디 또는 비밀번호를 확인해주세요.";
        try {
            const errorData = JSON.parse(responseText);
            if (errorData.detail) {
                message = errorData.detail;
            }
        } catch (e) {
        }
        document.getElementById('auth-messages').innerHTML = `<p>${message}</p>`;
    }
</script>